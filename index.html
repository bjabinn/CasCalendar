<html>
    <head>        
        <link href="https://fonts.googleapis.com/css?family=Montserrat%3A400%2C700%7CBitter%3A400%2C700&display=swap" rel="stylesheet" nonce="">
        <link href="https://fonts.googleapis.com/css?family=Bitter%3Ai%2Cbi%2C700%2C400%2C500%7CMontserrat%3Ai%2Cbi%2C700%2C400&amp;display=swap" rel="stylesheet" nonce="">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <link rel="stylesheet" href="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.css" />        
        <script src="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.js"></script>
        <link rel="stylesheet" href="./myTheme.css" />
        <title>TORNEOS AJEDREZ</title>
    </head>
    <body>   
        <div id="cabecera">
            <div id="outerLogo">
                <img id="logo" src="./logoRedondoSinLetras.jpg">
            </div>
            <div id="letreros">
                <spam id="letrero1">Casa del Ajedrez de Sevilla</spam>
                <spam id="letrero2">Información Torneos adaptada a padres, noveles y no tan noveles</spam>
            </div>
        </div>
        <div>
            <div id="calendarMenu">
                <span id="menu-navi">
                    <button type="button" class="calendar-btn calendar-move-today" onclick="today();">Today</button>
                    <button type="button" class="calendar-btn calendar-move-day" onclick="previousMonth();">
                        <i class="calendar-icon ic-arrow-line-left"></i>
                    </button>
                    <button type="button" class="calendar-btn calendar-move-day" onclick="nextMonth();">
                        <i class="calendar-icon ic-arrow-line-right"></i>
                    </button>
                </span>
                <span class="calendar-render-range" id="rangoFecha"></span>
            </div>
        </div>        
        <div id="calendario"></div>
        <div id="releaseDate">20230619-1007</div>
        
        <script>
            $(document).ready(function() {  
                actualizaPeriodoCalendario();
            });

            var Calendar = window.tui.Calendar;

            var cal = new Calendar('#calendario', {
                calendars: [], 
                usageStatistics: false, 
                useDetailPopup: true,
                month: {
                    startDayOfWeek: 1, 
                    dayNames: ["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],
                    visibleWeeksCount: 5,
                },

                defaultView: 'month',                
            });

            //http://localhost:8080
            fetch('https://cas-calendar-api.herokuapp.com/calendar', {
                    headers: {"Content-Type": "application/json; charset=utf-8"}
            }).then(function (response) {
                response.json().then(function (response) {
                    var eventToCalendar = '[';
                    for (var i=0; i < response.length; i++){
                        var evento = response[i];

                        var comienzoConverted = evento.comienzo.replace(/\//g, "-").replace(" ", "T") + ":00";
                        var finConverted = evento.fin.replace(/\//g, "-").replace(" ", "T") + ":00";

                        eventToCalendar =  eventToCalendar + 
                                               '{' + 
                                                    '"title": "' + evento.nombreTorneo + '", ' + 
                                                    '"body": "<p><b>Sistema juego</b>:' + evento.sistemaDeJuego + '</p>' + 
                                                        '<p><b>Precio</b>:' + evento.precio + '</p>' + 
                                                        "<p><b>Bases</b>:<a target='_blank' href='" + evento.basesURL + "'>aqui</a></p>" + 
                                                        "<p><b>Notas</b>:" + evento.notas + "</p>\"," + 
                                                    '"start": "' + comienzoConverted + "\", " + 
                                                    '"end": "' + finConverted + "\", " + 
                                                    '"location":' + "\"" + evento.location + "\"," + 
                                                    '"isReadOnly":true, ' + 
                                                    '"isVisible":' + evento.visible + 
                                              '}, ';
                    }
                    eventToCalendar = eventToCalendar.substring(0, eventToCalendar.length-2) + ']';
                    //console.log(eventToCalendar);
                    var eventToCalendarJson = JSON.parse(eventToCalendar);
                    cal.createEvents(eventToCalendarJson);
                });
            });

            function today() {
                cal.today();
                actualizaPeriodoCalendario();
            }

            function nextMonth() {
                cal.next();
                actualizaPeriodoCalendario();
            }

            function previousMonth(){
                cal.prev();
                actualizaPeriodoCalendario();
            }

            function actualizaPeriodoCalendario(){
                var diaActual = cal.getDateRangeStart().getDate();
                diaActual = diaActual < 10 ? '0' + diaActual : diaActual;
                var mesActual = cal.getDateRangeStart().getMonth() + 1;
                mesActual = mesActual < 10 ? '0' + mesActual : mesActual; 
                var diaMesAñoStart = diaActual + "-" + mesActual + "-" + cal.getDateRangeStart().getFullYear() + " al ";

                var diaFinal = cal.getDateRangeEnd().getDate();
                diaFinal = diaFinal < 10 ? '0' + diaFinal : diaFinal;
                var mesFinal = cal.getDateRangeEnd().getMonth() + 1;
                mesFinal = mesFinal < 10 ? '0' + mesFinal : mesFinal; 
                var diaMesAñoFinal = diaMesAñoStart + diaFinal + "-" + mesFinal + "-" + cal.getDateRangeEnd().getFullYear();
                
                $("#rangoFecha").text(diaMesAñoFinal);
            }

        </script>
    </body>
</html>